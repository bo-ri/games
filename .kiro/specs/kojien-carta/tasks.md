# Implementation Plan

## Phase 1: データ取得と検証

- [x] 1. データ取得と検証の基盤を整備する
- [x] 1.1 静的 JSON の取得と検証を成立させる
  - ゲームIDに対応したデータを取得できるようにする
  - `meta` と `items` を必須として扱い、欠落時は不正扱いにする
  - `description`/`howtoread_description`/`answer`/`howtoread_answer` の欠落を検知する
  - _Requirements: 1.1, 1.2, 1.3_
- [x] 1.2 取得失敗・形式不正の表示と開始制御を整える
  - 取得失敗時は理由表示と開始無効を反映する
  - 形式不正時は理由表示と開始無効を反映する
  - 取得成否を画面で確認できる状態にする
  - _Requirements: 1.4, 1.5, 1.6_

## Phase 2: ゲーム情報とレイアウト

- [x] 2. 画面メタ情報とレイアウトを整える
- [x] 2.1 選択済みゲーム情報とメタ情報を表示する
  - 遷移時に選択済みゲーム名を表示する
  - 読み込み完了後に説明文を表示し、続けてタイトルを表示する
  - 現在選択中のゲーム名を常に表示する
  - _Requirements: 2.1, 2.2, 2.3, 2.5_
- [x] 2.2 読み札表示領域の配置とサイズを確定する
  - 読み札 UI を画面中央に固定して配置する
  - 表示領域を画面の 60%〜80% に収める
  - 読み札カードの高さを 50vh に固定する
  - 読み札本文を 15 文字ごとに改行する
  - _Requirements: 7.3, 7.4, 7.5, 7.6_

## Phase 3: 読み上げフロー制御

- [x] 3. 読み上げフローとセッション制御を構築する
- [x] 3.1 ランダム出題と進行状態の管理を整える
  - 札の出題順を重複なく決定する
  - 現在の出題番号と残数を更新できるようにする
  - 全件読み上げ後は終了状態へ遷移する
  - _Requirements: 3.1, 3.6, 3.7_
- [x] 3.2 読み上げスケジュールと待機状態を管理する
  - 次へ押下後の 3 秒待機中のみローディングを表示する
  - 1回目と2回目の読み上げ間隔を 3 秒として維持する
  - 2回目読み上げ後の 10 秒待機と answer 読み上げを順守する
  - _Requirements: 4.1, 4.2, 4.3, 4.4_
- [x] 3.3 次へ操作・終了・リセットの遷移を定義する
  - 2回読み上げ後に次へ操作が有効になる条件を反映する
  - 次へ操作で未出題の札を選択できるようにする
  - 残札なし時の終了表示とリセット表示を切り替える
  - _Requirements: 3.2, 3.3, 3.4, 3.5, 5.15_
- [x] 3.4 一時停止と再開の進行制御を整える
  - 一時停止中は読み上げ進行を停止する
  - 再開時に直前の進行状態へ復帰する
  - _Requirements: 6.2, 6.3, 6.4_

## Phase 4: 読み上げ制御と速度設定

- [x] 4. 読み上げ制御と速度設定を実装する
- [x] 4.1 音声読み上げと文字進行通知を連携する
  - 読み上げの開始・進行・完了を通知できるようにする
  - 読み上げ失敗時は停止とエラー通知を扱えるようにする
  - _Requirements: 4.1, 4.3, 4.4, 5.2, 5.7_
- [x] 4.2 速度設定とサンプル読み上げを接続する
  - 速度変更時にサンプルテキストを読み上げる
  - 設定済み速度を以降の読み上げに適用する
  - _Requirements: 8.2, 8.3_

## Phase 5: UI コンポーネント

- [x] 5. UI コンポーネントを実装する
- [x] 5.1 読み札カードの表示と文字送りを整える
  - description を読み上げ開始時に表示する
  - 読み上げ中は文字送りを行い、完了後に全文表示へ切り替える
  - 札が提示中は description と answer の表示内容を保持する
  - 札の縦書き表示とカード UI の表現を反映する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.9, 7.1, 7.2, 7.5, 7.6_
- [x] 5.2 解答モーダルとふりがな表示を整える
  - answer の読み上げ開始時にモーダルを表示する
  - `howtoread_answer` を answer のふりがなとして表示する
  - 読み上げ中は文字送りを行い、完了後に全文表示へ切り替える
  - 次へボタンをモーダル上に配置し、操作可能状態を反映する
  - _Requirements: 5.5, 5.6, 5.7, 5.8, 5.14_
- [x] 5.3 読み上げ済み履歴リストを表示する
  - 読み上げ済みの札を全件保持して表示する
  - 直近の読み上げ順で上から表示し、リスト形式で区切る
  - _Requirements: 5.10, 5.11, 5.12, 5.13_
- [x] 5.4 セッション操作 UI と状態表示を整える
  - 開始/一時停止/再開/リセット/トップ遷移の操作を提供する
  - 進行状態を画面上で表示する
  - _Requirements: 3.5, 6.1, 6.2, 6.4, 6.7, 6.8_
- [x] 5.5 読み上げ待機中のローディング表示を実装する
  - 次の札開始前の待機中のみローディングを表示する
  - _Requirements: 4.2_
- [x] 5.6 読み上げ速度スライダーを表示する
  - 右上に速度調整 UI を配置する
  - _Requirements: 8.1_

## Phase 6: 画面統合と状態連携

- [x] 6. 画面統合と状態連携を仕上げる
- [x] 6.1 読み札表示の保持と札切り替えを連携する
  - 札の表示を維持したまま次の札へ切り替える
  - _Requirements: 5.9, 5.15_
- [x] 6.2 解答モーダル表示と次へ操作の連携を整える
  - 読み上げフェーズに合わせてモーダル表示を切り替える
  - 次へ操作の有効化タイミングを同期する
  - _Requirements: 3.2, 3.3, 5.5, 5.14_
- [x] 6.3 進行状態と残数表示をフローと同期する
  - 進行中/終了状態と残数を UI に反映する
  - _Requirements: 3.7, 6.8_
- [x] 6.4 終了・リセット時の初期化を UI に反映する
  - 残札なし時の終了表示を反映する
  - リセット完了後に初期状態へ戻す
  - _Requirements: 3.4, 3.5, 6.5, 6.6_

## Phase 7: テスト

- [x] 7. テストを整備する
- [x] 7.1 データ取得と検証のテストを追加する
  - 取得失敗・形式不正・必須項目欠落の検証を行う
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_
- [x] 7.2 読み上げフローと操作のテストを追加する
  - ランダム出題、待機時間、次へ表示、停止/再開の状態遷移を確認する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 4.1, 4.2, 4.3, 4.4, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_
- [x] 7.3 UI 表示と読み上げ同期のテストを追加する
  - 読み札/解答モーダル/履歴/速度操作の表示と同期を確認する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9, 5.10, 5.11, 5.12, 5.13, 5.14, 5.15, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 8.1, 8.2, 8.3_
